<style type="text/css">
    a {
        cursor: pointer;
    }
    a:link {
        color: black;
        text-decoration: none;
    }
    a:visited {
        color: black;
        text-decoration: none;
    }
    a:hover {
        color: black;
        text-decoration: none;
    }
    .card {
        border: none;
        border-radius: 1rem;
        box-shadow: 0 2px 8px rgba(0,0,0,.08);
        transition: transform 0.2s, box-shadow 0.2s;
    }
    .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 4px 12px rgba(0,0,0,.12);
    }
    .card-img-top {
        border-top-left-radius: 1rem;
        border-top-right-radius: 1rem;
    }
    .card-body {
        padding: 1.5rem;
    }
    .card-title {
        color: #343a40;
        font-weight: 600;
    }
    .card-title:hover {
        color: #228be6;
    }
    .sort-buttons a {
        padding: 0.5rem 1rem;
        border-radius: 2rem;
        transition: background-color 0.2s;
        text-decoration: none !important;  /* ë°‘ì¤„ ì œê±° */
        cursor: pointer;
    }
    .sort-buttons a:hover {
        background-color: #e7f5ff;
        text-decoration: none;
    }
    .sort-buttons a.active {
        color: #228be6;
        font-weight: bold;
        text-decoration: none;
    }
    .search-form input {
        border-radius: 2rem;
        padding-left: 1.5rem;
    }
    .search-form .btn {
        border-radius: 2rem;
        padding-left: 1.5rem;
        padding-right: 1.5rem;
    }
    .pagination .page-link {
        border: none;
        color: #495057;
        margin: 0 0.2rem;
        border-radius: 0.5rem;
    }
    .pagination .page-item.active .page-link {
        background-color: #228be6;
        border-color: #228be6;
    }
    
    /* ëª¨ë°”ì¼ ìµœì í™” ìŠ¤íƒ€ì¼ */
    @media (max-width: 768px) {
        .card {
            margin-bottom: 1rem;  /* ì¹´ë“œ ê°„ê²© ì¡°ì • */
        }
        
        .card-body {
            padding: 1rem;  /* ì¹´ë“œ ë‚´ë¶€ íŒ¨ë”© ì¶•ì†Œ */
        }
        
        .sort-buttons {
            margin-bottom: 1rem;  /* ì •ë ¬ ë²„íŠ¼ê³¼ ê²€ìƒ‰ì°½ ì‚¬ì´ ê°„ê²© */
            text-align: center;  /* ì •ë ¬ ë²„íŠ¼ ì¤‘ì•™ ì •ë ¬ */
        }
        
        .sort-buttons a {
            padding: 0.3rem 0.7rem;  /* ë²„íŠ¼ í¬ê¸° ì¶•ì†Œ */
            font-size: 0.9rem;  /* í°íŠ¸ í¬ê¸° ì¶•ì†Œ */
        }
        
        .search-form {
            width: 100%;  /* ê²€ìƒ‰ì°½ ì „ì²´ ë„ˆë¹„ ì‚¬ìš© */
            margin-bottom: 1rem;
        }
        
        .carousel {
            margin-bottom: 2rem !important;  /* ìºëŸ¬ì…€ í•˜ë‹¨ ì—¬ë°± ì¡°ì • */
        }
        
        .pagination .page-link {
            padding: 0.4rem 0.8rem;  /* í˜ì´ì§€ë„¤ì´ì…˜ ë²„íŠ¼ í¬ê¸° ì¶•ì†Œ */
            font-size: 0.9rem;
        }
    }
    
    /* íƒœë¸”ë¦¿ ìµœì í™” */
    @media (min-width: 769px) and (max-width: 1024px) {
        .card-title {
            font-size: 0.9rem;  /* íƒœë¸”ë¦¿ì—ì„œ ì œëª© í¬ê¸° ì¡°ì • */
        }
        
        .col-md-3 {
            flex: 0 0 50%;  /* íƒœë¸”ë¦¿ì—ì„œ 2ì—´ë¡œ í‘œì‹œ */
            max-width: 50%;
        }
    }

    /* ë¡œë”© ìŠ¤í”¼ë„ˆ ìŠ¤íƒ€ì¼ */
    .loading-spinner {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 200px;  /* ë†’ì´ ì¡°ì • */
        margin: 2rem 0;     /* ìƒí•˜ ì—¬ë°± ì¶”ê°€ */
    }

    .spinner-border {
        width: 3rem;
        height: 3rem;
        color: #228be6;
    }

    /* ì»¨í…ì¸  ìˆ¨ê¹€ ìŠ¤íƒ€ì¼ */
    .content-container {
        opacity: 0;
        transition: opacity 0.3s ease-in-out;
    }

    .content-container.loaded {
        opacity: 1;
    }
</style>

<!-- ë¡œë”© ìŠ¤í”¼ë„ˆ ì¶”ê°€ -->
<div class="container">
    <!-- ë°°ë„ˆ -->
    <div class="row">
        <div class="col-12 mb-md-5">
            <div id="carouselExampleIndicators" class="carousel slide" data-bs-ride="carousel">
                <div class="carousel-indicators">
                    <button
                        type="button"
                        data-bs-target="#carouselExampleIndicators"
                        data-bs-slide-to="0"
                        class="active"
                        aria-current="true"
                        aria-label="Slide 1"
                    ></button>
                    <button
                        type="button"
                        data-bs-target="#carouselExampleIndicators"
                        data-bs-slide-to="1"
                        aria-label="Slide 2"
                    ></button>
                    <button
                        type="button"
                        data-bs-target="#carouselExampleIndicators"
                        data-bs-slide-to="2"
                        aria-label="Slide 3"
                    ></button>
                </div>
                <div class="carousel-inner">
                    <div class="carousel-item active">
                        <a href="https://forms.gle/mQgPoKs9G4k7mtDo8">
                        <img
                            src="./media/banner/banner_sky.png"
                            class="d-block w-100"
                            style="object-fit: cover;"
                            alt="..."
                        />
                        </a>
                    </div>
                    <div class="carousel-item">
                        <a href="https://forms.gle/mQgPoKs9G4k7mtDo8">
                        <img
                            src="/media/banner/banner_sky.png"
                            class="d-block w-100"
                            style="object-fit: cover;"
                            alt="..."
                        />
                        </a>
                    </div>
                    <div class="carousel-item">
                        <a href="https://forms.gle/mQgPoKs9G4k7mtDo8">
                        <img
                            src="/media/banner/banner_sky.png"
                            class="d-block w-100"
                            style="object-fit: cover;"
                            alt="..."
                        />
                        </a>
                    </div>
                </div>
                <button
                    class="carousel-control-prev"
                    type="button"
                    data-bs-target="#carouselExampleIndicators"
                    data-bs-slide="prev"
                >
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Previous</span>
                </button>
                <button
                    class="carousel-control-next"
                    type="button"
                    data-bs-target="#carouselExampleIndicators"
                    data-bs-slide="next"
                >
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Next</span>
                </button>
            </div>
        </div>
    </div>

    <!-- ê²€ìƒ‰ ë° ì •ë ¬ -->
    <div class="row justify-content-between align-items-center mb-3 mb-md-5">
        <div class="col-md-4 sort-buttons">
            <h5 class="mb-0">
                <a id="latest" class="me-2">ìµœì‹ ìˆœ</a>
                <a id="likes" class="me-2">ì¢‹ì•„ìš”ìˆœ</a>
                <a id="views">ì¡°íšŒìˆ˜ìˆœ</a>
            </h5>
        </div>
        <div class="col-md-4 search-form">
            <form method="GET" action="{% url 'community:post_list' %}" class="d-flex">
                <input class="form-control me-2" type="search" placeholder="í”„ë¡œì íŠ¸ ê²€ìƒ‰í•˜ê¸°" name="q" id="q">
                <button class="btn btn-outline-primary" type="submit" id="submit">ê²€ìƒ‰</button>
            </form>
        </div>
    </div>

    <!-- ë¡œë”© ìŠ¤í”¼ë„ˆ -->
    <div class="loading-spinner">
        <div class="spinner-border" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>

    <!-- ì»¨í…ì¸  ì»¨í…Œì´ë„ˆ -->
    <div class="content-container">
        <div class="row">
            {% for post in page_obj %}
            <div class="col-12 col-sm-6 col-md-4 col-lg-3 mb-4">
                <div class="card h-100">
                    <div class="media-container">
                        <img
                            src="{{ post.image.url }}"
                            class="card-img-top"
                            style="object-fit: cover; height: 200px;"
                        />
                    </div>

                    <div class="card-body">
                        <a
                            class="card-title stretched-link"
                            href="{% url 'community:post_detail' pk=post.pk %}"
                           style="font-weight: bold; display:block; height: 20px"
                            >{{ post.title | slice:":36" }}</a
                        >

                        <br />
                        <hr />
                        <div class="row">
                            <div class="col-6" style="font-size: small;">
                                {{ post.author }}
                            </div>
                            <div class="col-6 text-end">
                                â™¥&nbsp;{{ post.like }} ğŸ‘&nbsp;{{ post.hit }} ğŸ—¨ï¸&nbsp;{{ post.get_comment_count }}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
    <ul class="pagination justify-content-center">
        <li class="page-item"><a class="page-link">&laquo;</a></li>
          
        {% if page_obj.number == page_obj.paginator.num_pages and page_obj.number|add:-4 > 1 %}
        <li class="page-item"><a class="page-link" href="#">{{ page_obj.number|add:-4 }}</a></li>
        {% endif %}
          
        {% if page_obj.number == page_obj.paginator.num_pages or page_obj.number == page_obj.paginator.num_pages|add:-1 %}
          {% if page_obj.number|add:-3 > 1 %}
        <li class="page-item"><a class="page-link" href="#">{{ page_obj.number|add:-3 }}</a></li>
          {% endif %}
        {% endif %}
          
        {% if page_obj.number|add:-2 >= 1 %}
          <li class="page-item"><a class="page-link" href="#">{{ page_obj.number|add:-2 }}</a></li> 
        {% endif %}
          
        {% if page_obj.has_previous %}
          <li class="page-item"><a class="page-link" href="#">{{ page_obj.number|add:-1 }}</a></li>
        {% endif %}
          
        
        <li class="page-item active"><a class="page-link">{{ page_obj.number }}</a></li>
        
         
        {% if page_obj.has_next %}
          <li class="page-item"><a class="page-link" href="#">{{ page_obj.number|add:1 }}</a></li>
        {% endif %}
        
        {% if page_obj.number|add:2 > page_obj.paginator.num_pages %}
        {% else %}
          <li class="page-item"><a class="page-link" href="#">{{ page_obj.number|add:2 }}</a></li>
        {% endif %}
          
        {% if page_obj.number == 1 or page_obj.number == 2 %}
            {% if page_obj.number|add:3 <= page_obj.paginator.num_pages %}
                                                                                                              
        <li class="page-item"><a class="page-link" href="#">{{ page_obj.number|add:3 }}</a></li>
            {% endif %}
        {% endif %}
          
        {% if page_obj.number == 1 and page_obj.number|add:4 <= page_obj.paginator.num_pages %}
        <li class="page-item"><a class="page-link" href="#">{{ page_obj.number|add:4 }}</a></li>
        {% endif %}
          
        <li class="page-item"><a class="page-link">&raquo;</a></li>
    </ul>
</div>

<script type="text/javascript">
    var latest = document.getElementById('latest');
    var likes = document.getElementById('likes');
    var views = document.getElementById('views');
    
    if (sessionStorage.getItem('o') == "-like") {
        latest.style.color = 'gray';
        likes.style.color = 'black';
        views.style.color = 'gray';
    }
    
    else if (sessionStorage.getItem('o') == "-hit") {
        latest.style.color = 'gray';
        likes.style.color = 'gray';
        views.style.color = 'black';
    }
    
    else {
        latest.style.color = 'black';
        likes.style.color = 'gray';
        views.style.color = 'gray';
    }
    
    window.onload = function() {
        $.ajax({
            type: 'GET',
            url: "{% url 'community:post_list' %}",
            data: { q: sessionStorage.getItem('query'), ordering: sessionStorage.getItem('o'), page: sessionStorage.getItem('page') },
            success: function (data) {
                $('#post_list').html(data);
            },
        });
    };
    
    $('#submit').click(function () {
        var q = document.getElementById("q").value;

        sessionStorage.setItem('query', q);
    });
    
    $('#brand').click(function () {
        var q = ''
        sessionStorage.setItem('query', q);
    });
    
    $('#latest').click(function () {
        var ordering = "-date";
        
        sessionStorage.setItem('o', ordering);
        
        $.ajax({
            type: 'GET',
            url: "{% url 'community:post_list' %}", // ì •ë ¬ ë·°ì˜ URLì„ ì—¬ê¸°ì— ì…ë ¥
            data: { q: sessionStorage.getItem('query'), ordering: sessionStorage.getItem('o'), page: sessionStorage.getItem('page') }, // ìµœì‹ ìˆœ ì •ë ¬
            success: function (data) {
                $('#post_list').html(data);
            },
        });
    });

    $('#likes').click(function () {
        var ordering = "-like";
        
        sessionStorage.setItem('o', ordering);
        
        $.ajax({
            type: 'GET',
            url: "{% url 'community:post_list' %}",
            data: { q: sessionStorage.getItem('query'), ordering: sessionStorage.getItem('o'), page: sessionStorage.getItem('page') }, // ì¢‹ì•„ìš”ìˆœ ì •ë ¬
            success: function (data) {
                $('#post_list').html(data);
            },
        });
    });

    $('#views').click(function () {
        var ordering = "-hit";
        
        sessionStorage.setItem('o', ordering);
        
        $.ajax({
            type: 'GET',
            url: "{% url 'community:post_list' %}",
            data: { q: sessionStorage.getItem('query'), ordering: sessionStorage.getItem('o'), page: sessionStorage.getItem('page') }, // ì¡°íšŒìˆ˜ìˆœ ì •ë ¬
            success: function (data) {
                $('#post_list').html(data);
            },
        });
    });
    
    $('.page-link').click(function () {
        
        var page_num = $(this).text();
        
        if(page_num == 'Â«') page_num = 1
        else if(page_num == 'Â»') page_num = '{{ page_obj.paginator.num_pages }}'
        
        sessionStorage.setItem('page', page_num)
        
        $.ajax({
            type: 'GET',
            url: "{% url 'community:post_list' %}",
            data: { q: sessionStorage.getItem('query'), ordering: sessionStorage.getItem('o'), page: sessionStorage.getItem('page') }, // ì¡°íšŒìˆ˜ìˆœ ì •ë ¬
            success: function (data) {
                $('#post_list').html(data);
            },
        });
    });

    $(document).ready(function() {
        // í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ ì‹œ
        $(window).on('load', function() {
            $('.loading-spinner').fadeOut(300, function() {
                $(this).remove();
                $('.content-container').addClass('loaded');
            });
        });
    });

    // AJAX ìš”ì²­ ì‹œ ë¡œë”© ì²˜ë¦¬
    $(document).ajaxStart(function() {
        $('.content-container').removeClass('loaded');
        $('.loading-spinner').show();
    }).ajaxComplete(function() {
        $('.loading-spinner').fadeOut(300, function() {
            $('.content-container').addClass('loaded');
        });
    });

</script>