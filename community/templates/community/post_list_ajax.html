<style type="text/css">
    a {
        cursor: pointer;
    }
    a:link {
        color: black;
        text-decoration: none;
    }
    a:visited {
        color: black;
        text-decoration: none;
    }
    a:hover {
        color: black;
        text-decoration: none;
    }
    .card {
        border: none;
        border-radius: 1rem;
        box-shadow: 0 2px 8px rgba(0,0,0,.08);
        transition: transform 0.2s, box-shadow 0.2s;
    }
    .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 4px 12px rgba(0,0,0,.12);
    }
    .card-img-top {
        border-top-left-radius: 1rem;
        border-top-right-radius: 1rem;
    }
    .card-body {
        padding: 1.5rem;
    }
    .card-title {
        color: #343a40;
        font-weight: 600;
    }
    .card-title:hover {
        color: #228be6;
    }
    .sort-buttons a {
        padding: 0.5rem 1rem;
        border-radius: 2rem;
        transition: background-color 0.2s;
        text-decoration: none !important;  /* 밑줄 제거 */
        cursor: pointer;
    }
    .sort-buttons a:hover {
        background-color: #e7f5ff;
        text-decoration: none;
    }
    .sort-buttons a.active {
        color: #228be6;
        font-weight: bold;
        text-decoration: none;
    }
    .search-form input {
        border-radius: 2rem;
        padding-left: 1.5rem;
    }
    .search-form .btn {
        border-radius: 2rem;
        padding-left: 1.5rem;
        padding-right: 1.5rem;
    }
    .pagination .page-link {
        border: none;
        color: #495057;
        margin: 0 0.2rem;
        border-radius: 0.5rem;
    }
    .pagination .page-item.active .page-link {
        background-color: #228be6;
        border-color: #228be6;
    }
    
    /* 모바일 최적화 스타일 */
    @media (max-width: 768px) {
        .card {
            margin-bottom: 1rem;  /* 카드 간격 조정 */
        }
        
        .card-body {
            padding: 1rem;  /* 카드 내부 패딩 축소 */
        }
        
        .sort-buttons {
            margin-bottom: 1rem;  /* 정렬 버튼과 검색창 사이 간격 */
            text-align: center;  /* 정렬 버튼 중앙 정렬 */
        }
        
        .sort-buttons a {
            padding: 0.3rem 0.7rem;  /* 버튼 크기 축소 */
            font-size: 0.9rem;  /* 폰트 크기 축소 */
        }
        
        .search-form {
            width: 100%;  /* 검색창 전체 너비 사용 */
            margin-bottom: 1rem;
        }
        
        .carousel {
            margin-bottom: 2rem !important;  /* 캐러셀 하단 여백 조정 */
        }
        
        .pagination .page-link {
            padding: 0.4rem 0.8rem;  /* 페이지네이션 버튼 크기 축소 */
            font-size: 0.9rem;
        }
    }
    
    /* 태블릿 최적화 */
    @media (min-width: 769px) and (max-width: 1024px) {
        .card-title {
            font-size: 0.9rem;  /* 태블릿에서 제목 크기 조정 */
        }
        
        .col-md-3 {
            flex: 0 0 50%;  /* 태블릿에서 2열로 표시 */
            max-width: 50%;
        }
    }

    /* 로딩 스피너 스타일 */
    .loading-spinner {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 200px;  /* 높이 조정 */
        margin: 2rem 0;     /* 상하 여백 추가 */
    }

    .spinner-border {
        width: 3rem;
        height: 3rem;
        color: #228be6;
    }

    /* 컨텐츠 숨김 스타일 */
    .content-container {
        opacity: 0;
        transition: opacity 0.3s ease-in-out;
    }

    .content-container.loaded {
        opacity: 1;
    }
</style>

<!-- 로딩 스피너 추가 -->
<div class="container">
    <!-- 배너 -->
    <div class="row">
        <div class="col-12 mb-md-5">
            <div id="carouselExampleIndicators" class="carousel slide" data-bs-ride="carousel">
                <div class="carousel-indicators">
                    <button
                        type="button"
                        data-bs-target="#carouselExampleIndicators"
                        data-bs-slide-to="0"
                        class="active"
                        aria-current="true"
                        aria-label="Slide 1"
                    ></button>
                    <button
                        type="button"
                        data-bs-target="#carouselExampleIndicators"
                        data-bs-slide-to="1"
                        aria-label="Slide 2"
                    ></button>
                    <button
                        type="button"
                        data-bs-target="#carouselExampleIndicators"
                        data-bs-slide-to="2"
                        aria-label="Slide 3"
                    ></button>
                </div>
                <div class="carousel-inner">
                    <div class="carousel-item active">
                        <a href="https://forms.gle/mQgPoKs9G4k7mtDo8">
                        <img
                            src="./media/banner/banner_sky.png"
                            class="d-block w-100"
                            style="object-fit: cover;"
                            alt="..."
                        />
                        </a>
                    </div>
                    <div class="carousel-item">
                        <a href="https://forms.gle/mQgPoKs9G4k7mtDo8">
                        <img
                            src="/media/banner/banner_sky.png"
                            class="d-block w-100"
                            style="object-fit: cover;"
                            alt="..."
                        />
                        </a>
                    </div>
                    <div class="carousel-item">
                        <a href="https://forms.gle/mQgPoKs9G4k7mtDo8">
                        <img
                            src="/media/banner/banner_sky.png"
                            class="d-block w-100"
                            style="object-fit: cover;"
                            alt="..."
                        />
                        </a>
                    </div>
                </div>
                <button
                    class="carousel-control-prev"
                    type="button"
                    data-bs-target="#carouselExampleIndicators"
                    data-bs-slide="prev"
                >
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Previous</span>
                </button>
                <button
                    class="carousel-control-next"
                    type="button"
                    data-bs-target="#carouselExampleIndicators"
                    data-bs-slide="next"
                >
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Next</span>
                </button>
            </div>
        </div>
    </div>

    <!-- 검색 및 정렬 -->
    <div class="row justify-content-between align-items-center mb-3 mb-md-5">
        <div class="col-md-4 sort-buttons">
            <h5 class="mb-0">
                <a id="latest" class="me-2">최신순</a>
                <a id="likes" class="me-2">좋아요순</a>
                <a id="views">조회수순</a>
            </h5>
        </div>
        <div class="col-md-4 search-form">
            <form method="GET" action="{% url 'community:post_list' %}" class="d-flex">
                <input class="form-control me-2" type="search" placeholder="프로젝트 검색하기" name="q" id="q">
                <button class="btn btn-outline-primary" type="submit" id="submit">검색</button>
            </form>
        </div>
    </div>

    <!-- 로딩 스피너 -->
    <div class="loading-spinner">
        <div class="spinner-border" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>

    <!-- 컨텐츠 컨테이너 -->
    <div class="content-container">
        <div class="row">
            {% for post in page_obj %}
            <div class="col-12 col-sm-6 col-md-4 col-lg-3 mb-4">
                <div class="card h-100">
                    <div class="media-container">
                        <img
                            src="{{ post.image.url }}"
                            class="card-img-top"
                            style="object-fit: cover; height: 200px;"
                        />
                    </div>

                    <div class="card-body">
                        <a
                            class="card-title stretched-link"
                            href="{% url 'community:post_detail' pk=post.pk %}"
                           style="font-weight: bold; display:block; height: 20px"
                            >{{ post.title | slice:":36" }}</a
                        >

                        <br />
                        <hr />
                        <div class="row">
                            <div class="col-6" style="font-size: small;">
                                {{ post.author }}
                            </div>
                            <div class="col-6 text-end">
                                ♥&nbsp;{{ post.like }} 👁&nbsp;{{ post.hit }} 🗨️&nbsp;{{ post.get_comment_count }}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- 페이지네이션 -->
    <ul class="pagination justify-content-center">
        <li class="page-item"><a class="page-link">&laquo;</a></li>
          
        {% if page_obj.number == page_obj.paginator.num_pages and page_obj.number|add:-4 > 1 %}
        <li class="page-item"><a class="page-link" href="#">{{ page_obj.number|add:-4 }}</a></li>
        {% endif %}
          
        {% if page_obj.number == page_obj.paginator.num_pages or page_obj.number == page_obj.paginator.num_pages|add:-1 %}
          {% if page_obj.number|add:-3 > 1 %}
        <li class="page-item"><a class="page-link" href="#">{{ page_obj.number|add:-3 }}</a></li>
          {% endif %}
        {% endif %}
          
        {% if page_obj.number|add:-2 >= 1 %}
          <li class="page-item"><a class="page-link" href="#">{{ page_obj.number|add:-2 }}</a></li> 
        {% endif %}
          
        {% if page_obj.has_previous %}
          <li class="page-item"><a class="page-link" href="#">{{ page_obj.number|add:-1 }}</a></li>
        {% endif %}
          
        
        <li class="page-item active"><a class="page-link">{{ page_obj.number }}</a></li>
        
         
        {% if page_obj.has_next %}
          <li class="page-item"><a class="page-link" href="#">{{ page_obj.number|add:1 }}</a></li>
        {% endif %}
        
        {% if page_obj.number|add:2 > page_obj.paginator.num_pages %}
        {% else %}
          <li class="page-item"><a class="page-link" href="#">{{ page_obj.number|add:2 }}</a></li>
        {% endif %}
          
        {% if page_obj.number == 1 or page_obj.number == 2 %}
            {% if page_obj.number|add:3 <= page_obj.paginator.num_pages %}
                                                                                                              
        <li class="page-item"><a class="page-link" href="#">{{ page_obj.number|add:3 }}</a></li>
            {% endif %}
        {% endif %}
          
        {% if page_obj.number == 1 and page_obj.number|add:4 <= page_obj.paginator.num_pages %}
        <li class="page-item"><a class="page-link" href="#">{{ page_obj.number|add:4 }}</a></li>
        {% endif %}
          
        <li class="page-item"><a class="page-link">&raquo;</a></li>
    </ul>
</div>

<script type="text/javascript">
    var latest = document.getElementById('latest');
    var likes = document.getElementById('likes');
    var views = document.getElementById('views');
    
    if (sessionStorage.getItem('o') == "-like") {
        latest.style.color = 'gray';
        likes.style.color = 'black';
        views.style.color = 'gray';
    }
    
    else if (sessionStorage.getItem('o') == "-hit") {
        latest.style.color = 'gray';
        likes.style.color = 'gray';
        views.style.color = 'black';
    }
    
    else {
        latest.style.color = 'black';
        likes.style.color = 'gray';
        views.style.color = 'gray';
    }
    
    window.onload = function() {
        $.ajax({
            type: 'GET',
            url: "{% url 'community:post_list' %}",
            data: { q: sessionStorage.getItem('query'), ordering: sessionStorage.getItem('o'), page: sessionStorage.getItem('page') },
            success: function (data) {
                $('#post_list').html(data);
            },
        });
    };
    
    $('#submit').click(function () {
        var q = document.getElementById("q").value;

        sessionStorage.setItem('query', q);
    });
    
    $('#brand').click(function () {
        var q = ''
        sessionStorage.setItem('query', q);
    });
    
    $('#latest').click(function () {
        var ordering = "-date";
        
        sessionStorage.setItem('o', ordering);
        
        $.ajax({
            type: 'GET',
            url: "{% url 'community:post_list' %}", // 정렬 뷰의 URL을 여기에 입력
            data: { q: sessionStorage.getItem('query'), ordering: sessionStorage.getItem('o'), page: sessionStorage.getItem('page') }, // 최신순 정렬
            success: function (data) {
                $('#post_list').html(data);
            },
        });
    });

    $('#likes').click(function () {
        var ordering = "-like";
        
        sessionStorage.setItem('o', ordering);
        
        $.ajax({
            type: 'GET',
            url: "{% url 'community:post_list' %}",
            data: { q: sessionStorage.getItem('query'), ordering: sessionStorage.getItem('o'), page: sessionStorage.getItem('page') }, // 좋아요순 정렬
            success: function (data) {
                $('#post_list').html(data);
            },
        });
    });

    $('#views').click(function () {
        var ordering = "-hit";
        
        sessionStorage.setItem('o', ordering);
        
        $.ajax({
            type: 'GET',
            url: "{% url 'community:post_list' %}",
            data: { q: sessionStorage.getItem('query'), ordering: sessionStorage.getItem('o'), page: sessionStorage.getItem('page') }, // 조회수순 정렬
            success: function (data) {
                $('#post_list').html(data);
            },
        });
    });
    
    $('.page-link').click(function () {
        
        var page_num = $(this).text();
        
        if(page_num == '«') page_num = 1
        else if(page_num == '»') page_num = '{{ page_obj.paginator.num_pages }}'
        
        sessionStorage.setItem('page', page_num)
        
        $.ajax({
            type: 'GET',
            url: "{% url 'community:post_list' %}",
            data: { q: sessionStorage.getItem('query'), ordering: sessionStorage.getItem('o'), page: sessionStorage.getItem('page') }, // 조회수순 정렬
            success: function (data) {
                $('#post_list').html(data);
            },
        });
    });

    $(document).ready(function() {
        // 페이지 로드 완료 시
        $(window).on('load', function() {
            $('.loading-spinner').fadeOut(300, function() {
                $(this).remove();
                $('.content-container').addClass('loaded');
            });
        });
    });

    // AJAX 요청 시 로딩 처리
    $(document).ajaxStart(function() {
        $('.content-container').removeClass('loaded');
        $('.loading-spinner').show();
    }).ajaxComplete(function() {
        $('.loading-spinner').fadeOut(300, function() {
            $('.content-container').addClass('loaded');
        });
    });

</script>